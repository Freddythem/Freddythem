using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Diagnostics.Metrics;
using System.Numerics;
using System.Security;
using System.Text.RegularExpressions;
using static System.Runtime.InteropServices.JavaScript.JSType;

class Program
{
    static void Main()
    {
        string filePath = "E:\\04_Programmierung\\AdventOfCode2025\\Input.txt";
        int lineNumber = 0;
        string[] inputFile;

        string[,] mathTable; //1. = spalte, 2. = zeile
        long ergebnisSpalte = 0;

        char[,] charTableForTesting;

        try
        {
            using (StreamReader sr = new StreamReader(filePath))
            {
                lineNumber = File.ReadLines(filePath).Count();
                inputFile = new string[lineNumber];

                for (int i = 0; i < lineNumber; i++)
                {
                    inputFile[i] = sr.ReadLine();
                }
                
                Console.WriteLine($"Neues Programm. Alle Daten aus Input.txt eingelesen. Zeilen: {lineNumber}\n");
                
                int mathTableLength = inputFile[0].Length;
                charTableForTesting = new char[mathTableLength, lineNumber];

                Console.WriteLine($"mathtableLength: {mathTableLength}");

                for (int i = 0; i < lineNumber; i++)
                {
                    char[] temp = inputFile[i].ToCharArray();

                    for (int j = 0; j < temp.Length; j++)
                    {
                        charTableForTesting[j, i] = temp[j];
                    }
                }
                Console.WriteLine($"\n Tabelle fertig. Jetzt Rechnen \n");

                long tempErgebnis = 0; ;
                char mathPlus = '+';
                char mathMulti = '*';
                List<int> zusammenrechnen = new List<int>();

                for (int i = mathTableLength - 1 ; i >= 0 ; i--)
                {
                    string check = "";
                   
                    for (int j = 0; j < lineNumber - 1; j++)
                    {
                        check = check + charTableForTesting[i, j];
                    }
                    if(check.Trim().Length != 0)
                    {
                        zusammenrechnen.Add(int.Parse(check));
                    }

                    if (charTableForTesting[i, lineNumber - 1] == mathPlus)
                    {
                        tempErgebnis = 0;
                        for(int m = 0; m < zusammenrechnen.Count; m++)
                        {
                            tempErgebnis += zusammenrechnen[m];
                        }
                        ergebnisSpalte += tempErgebnis;                       
                        zusammenrechnen.Clear();
                    }
                    else if (charTableForTesting[i, lineNumber - 1] == mathMulti)
                    {
                        tempErgebnis = 1;
                        for (int m = 0; m < zusammenrechnen.Count; m++)
                        {
                            tempErgebnis *= zusammenrechnen[m];
                        }
                        ergebnisSpalte += tempErgebnis;
                        zusammenrechnen.Clear();
                    }
                }
                Console.WriteLine($"Endergebnis: {ergebnisSpalte}");
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Fehler: " + e.Message);
        }
    }
}
