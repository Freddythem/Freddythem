using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Diagnostics.Metrics;
using System.Numerics;
using System.Security;
using System.Text.RegularExpressions;
using static System.Runtime.InteropServices.JavaScript.JSType;

class Program
{
    static void Main()
    {
        //string filePath = "E:\\04_Programmierung\\AdventOfCode2025\\Input.txt"; //PC Ade
        string filePath = "C:\\Users\\meierf\\source\\repos\\ConsoleApp1\\ConsoleApp1\\Input.txt"; //PC Goe
        int lineNumber = 0;
        int lineLength = 0;
        string[][] inputFile;
        int counterDistancesChecked = 0;

        int numberOfPairs = 1000; // Test 10, sonst 1000!
        if (filePath.Contains("Test"))
        {
            numberOfPairs = 10;
        }

        double lastConnectedXMulti = 0;
        long numberOfCircuits = 0;

        try
        {
            using (StreamReader sr = new StreamReader(filePath))
            {
                lineNumber = File.ReadLines(filePath).Count();

                inputFile = new string[lineNumber][];

                for (int i = 0; i < lineNumber; i++)
                {
                    inputFile[i] = sr.ReadLine().Split(",");
                }
                lineLength = inputFile[0].Length;

                Console.WriteLine($"\n");

                double x1 = 0, y1 = 0, z1 = 0;
                double x2 = 0, y2 = 0, z2 = 0;
                double distance = 0;

                string[] pairOne = new string[2];
                string[] pairTwo = new string[2];
                double[] pairOneTest = new double[3] { 0, 0, 0 };
                double[] pairTwoTest = new double[3] { 0, 0, 0 };

                List<double> distancesList = new List<double>();

                List<double[]> tolleKomplexeListeFuckOff = new List<double[]>();
                List<List<double[]>> fuckingBigList = new List<List<double[]>>();

                List<double[]> listDistanceForFUckingBigList = new List<double[]>();
                fuckingBigList.Add(listDistanceForFUckingBigList);
               

                for (int i = 0; i < lineNumber - 1; i++)
                {
                    pairOne = inputFile[i];

                    x1 = int.Parse(pairOne[0]);
                    y1 = int.Parse(pairOne[1]);
                    z1 = int.Parse(pairOne[2]);

                    for (int j = i + 1; j < lineNumber; j++)
                    {
                        pairTwo = inputFile[j];

                        x2 = int.Parse(pairTwo[0]);
                        y2 = int.Parse(pairTwo[1]);
                        z2 = int.Parse(pairTwo[2]);

                        distance = CalculateDistance3D(x1, y1, z1, x2, y2, z2);

                        double[] doubleForFuckingList = new double[7] { distance, x1, y1, z1, x2, y2, z2 }; //spielzeug. nicht genutzt
                        tolleKomplexeListeFuckOff.Add(doubleForFuckingList); //spielzeug. nicht genutzt
                    }
                }

                tolleKomplexeListeFuckOff.Sort((a, b) => a[0].CompareTo(b[0]));

                Console.WriteLine($"Bis hier läufts easy mit berechnen :) ");

                bool numberOfPairsReached = false;

                for (int i = 0; i < tolleKomplexeListeFuckOff.Count; i++)
                {
                    counterDistancesChecked++;

                    pairOneTest = new double[3] { tolleKomplexeListeFuckOff[i][1], tolleKomplexeListeFuckOff[i][2], tolleKomplexeListeFuckOff[i][3] };
                    pairTwoTest = new double[3] { tolleKomplexeListeFuckOff[i][4], tolleKomplexeListeFuckOff[i][5], tolleKomplexeListeFuckOff[i][6] };

                    //Console.WriteLine($"Pos.{i} : {pairOneTest[0]}, {pairOneTest[1]}, {pairOneTest[2]}, und {pairTwoTest[0]},{pairTwoTest[1]},{pairTwoTest[2]} , Enter für weiter");
                    //Console.ReadLine();

                    int counterCheckLists = 0;
                    bool distanceInAnyList = false;

                    for (int l = 0; l < fuckingBigList.Count; l++)
                    {

                        if (fuckingBigList[l].Any(a => a.SequenceEqual(pairOneTest)))
                        {
                            if (!fuckingBigList[l].Any(a => a.SequenceEqual(pairTwoTest)))
                            {
                                fuckingBigList[l].Add(pairTwoTest);
                            }
                            distanceInAnyList = true;
                        }
                        else if (fuckingBigList[l].Any(a => a.SequenceEqual(pairTwoTest)))
                        {
                            if (!fuckingBigList[l].Any(a => a.SequenceEqual(pairOneTest)))
                            {
                                fuckingBigList[l].Add(pairOneTest);
                            }
                            distanceInAnyList = true;
                        }

                        counterCheckLists++;

                        if (counterCheckLists == fuckingBigList.Count)
                        {
                            if (!distanceInAnyList)
                            {
                                listDistanceForFUckingBigList = new List<double[]>();
                                fuckingBigList.Add(listDistanceForFUckingBigList);
                                fuckingBigList[l + 1].Add(pairOneTest);
                                fuckingBigList[l + 1].Add(pairTwoTest);
                            }
                        }

                        for (int m = 0; m < fuckingBigList.Count; m++)
                        {
                            if (l != m)
                            {
                                if (fuckingBigList[l].Any(item1 => fuckingBigList[m].Any(item2 => item1.SequenceEqual(item2))))
                                {
                                    foreach (var arr in fuckingBigList[m])
                                    {
                                        if (!fuckingBigList[l].Any(a => a.SequenceEqual(arr)))
                                        {
                                            fuckingBigList[l].Add(arr);
                                        }
                                    }
                                    fuckingBigList[m].Clear();

                                    m -= 1;
                                }
                            }
                        }

                        if (counterDistancesChecked >= numberOfPairs)
                        {                        
                            for (int c = 0; c < fuckingBigList.Count; c++)
                            {
                                if (fuckingBigList[c].Count == (lineNumber))
                                {
                                    lastConnectedXMulti = pairOneTest[0] * pairTwoTest[0];
                                    i = tolleKomplexeListeFuckOff.Count;

                                }
                            }
                        }
                    }

                }
                Console.WriteLine($"\n Endergebnis X-Koordinaten des letzten Paares multipliziert: {lastConnectedXMulti}");               
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Fehler: " + e.Message);
        }
    }

    static double CalculateDistance3D(double x1, double y1, double z1, double x2, double y2, double z2)
    {
        return Math.Sqrt(Math.Pow(x2 - x1, 2) +
                         Math.Pow(y2 - y1, 2) +
                         Math.Pow(z2 - z1, 2));
    }
}
